<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include("./partials/meta") %>
    <title>Manga Store - Manage Tickets</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="/css/framework.css" />
    <link rel="stylesheet" href="/css/build.min.css" />
    <link rel="stylesheet" href="/css/profile.css" />
  </head>
  <body class="bg-background bg-background-light dark:bg-background-dark">
    <%- include("./partials/header") %> <%- include("./partials/alerts-popups") %> <%- include("./partials/loader") %>
    <main class="min-h-screen flex w-full gap-3 pt-16 mb-10">
      <section
        class="w-full flex-1 flex mx-auto py-8 flex-col px-6 rounded-lg border-2 border-primary-light/20 dark:border-primary-dark/10">
        <!-- Header Section with gradient background -->
        <div
          class="flex justify-between items-center mb-8 p-4 rounded-lg bg-gradient-to-r from-primary/10 to-accent/10 dark:from-primary-dark/10 dark:to-accent-dark/10">
          <h1 class="text-lg sm:text-xl md:text-2xl font-semibold text-primary dark:text-primary-dark">
            Manage Tickets
          </h1>
          <a
            href="/support/ticket/open-ticket"
            id="open-ticket-btn"
            class="bg-accent-light hover:bg-accent-light/90 dark:bg-primary-dark dark:hover:bg-primary-dark/90 text-white px-6 py-2.5 rounded-lg transition-colors duration-200 font-medium shadow-sm hover:shadow-md border border-accent hover:border-accent/90">
            Create Ticket
          </a>
        </div>

        <!-- Table Section -->
        <div class="flex flex-col gap-4">
          <div class="overflow-x-auto rounded-lg border-2 border-secondary-light/20 dark:border-secondary-dark/50">
            <table class="w-full bg-[#fff1b8] dark:bg-background-dark">
              <!-- Table Header -->
              <thead>
                <tr
                  class="bg-secondary-light/20 dark:bg-secondary-dark/5 border-b-2 border-secondary/20 dark:border-secondary-dark/10">
                  <th class="px-6 py-4 text-left font-semibold text-secondary-light dark:text-text-dark">Ticket ID</th>
                  <th class="px-6 py-4 text-left font-semibold text-secondary-light dark:text-text-dark">Subject</th>
                  <th class="px-6 py-4 text-left font-semibold text-secondary-light dark:text-text-dark">Status</th>
                  <th class="px-6 py-4 text-left font-semibold text-secondary-light dark:text-text-dark">Created At</th>
                  <th class="px-6 py-4 text-left font-semibold text-secondary-light dark:text-text-dark">Actions</th>
                </tr>
              </thead>

              <!-- Table Body -->
              <tbody>
                <% tickets.forEach(ticket => { %>
                <tr
                  class="border-b border-secondary-light/10 dark:border-secondary-dark/10 hover:bg-primary/5 dark:hover:bg-secondary-dark/5 transition-colors duration-150">
                  <!-- Ticket ID -->
                  <td class="px-6 py-4 text-sm">
                    <span class="text-primary-light font-medium dark:text-text-dark/80"> <%= ticket.id %> </span>
                  </td>

                  <!-- Subject -->
                  <td class="px-6 py-4 text-sm text-text-light dark:text-text-dark/80 truncate max-w-xs">
                    <%= ticket.description %>
                  </td>

                  <!-- Status -->
                  <td class="px-6 py-4 text-sm font-medium">
                    <span
                      class="<%= ticket.status === 'open' ? 'text-orange-600 bg-orange-200/50' : ticket.status === 'resolved' ? 'text-green-600 bg-green-200/75' : 'text-yellow-600 bg-yellow-200/75' %> px-3 py-1.5 rounded-full font-bold">
                      <%= ticket.status %>
                    </span>
                  </td>

                  <!-- Created At -->
                  <td class="px-6 py-4 text-sm text-accent-light/90 dark:text-text-dark/70">
                    <%= new Date(ticket.createdAt.toDate()).toLocaleString("en-us") %>
                  </td>

                  <!-- Actions -->
                  <td class="px-6 py-4 text-sm">
                    <a
                      href="/support/ticket/view/<%= ticket.id %>"
                      class="inline-block bg-primary-light text-white hover:bg-primary-light/90 dark:bg-primary-dark dark:hover:bg-primary-dark/90 px-4 py-2 rounded-lg transition-all duration-200 font-medium border border-primary-light hover:border-primary-light/90 shadow-sm hover:shadow-md">
                      View
                    </a>
                  </td>
                </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Empty State (if needed) -->
        <% if (tickets.length === 0) { %>
        <div
          class="text-center py-10 bg-primary/5 dark:bg-primary-dark/5 rounded-lg mt-4 border-2 border-dashed border-primary/20 dark:border-primary-dark/20">
          <p class="text-primary-light dark:text-primary-dark text-lg font-medium">
            No tickets found. Create your first support ticket!
          </p>
        </div>
        <% } %>
      </section>
    </main>

    <%- include("./partials/footer") %>
    <script src="/js/cart.js"></script>
  </body>
</html>
